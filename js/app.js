(()=>{"use strict";function t(t,e){var r=Math.random()*(e-t)+t;return Math.floor(r)}function e(e){var r=e.start,n=e.end,o=e.stepsCount,i=e.includeStart,u=void 0!==i&&i,a=e.includeEnd,c=(n-r)/o;return r+t(u?0:1,void 0!==a&&a?o+1:o)*c}function r(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return[r*t[0]+n*e[0],r*t[1]+n*e[1]]}function n(t,e){return Math.abs(t-e)<1e-6}function o(t){var e=t.clientX,r=t.clientY,n=t.draggedObject,o=t.width,i=t.height;n.style.left="".concat(e+window.scrollX-o/2,"px"),n.style.top="".concat(r+window.scrollY-i/2,"px")}function i(t){return"".concat(t,"-").concat(Math.random().toString(16).slice(2))}function u(t,e){var r=null;return function(){if(!r)return r=Date.now(),void t.apply(void 0,arguments);Date.now()-r<e||(r=Date.now(),t.apply(void 0,arguments))}}function a(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,o,i,u,a=[],c=!0,l=!1;try{if(i=(r=r.call(t)).next,0===e){if(Object(r)!==r)return;c=!1}else for(;!(c=(n=i.call(r)).done)&&(a.push(n.value),a.length!==e);c=!0);}catch(t){l=!0,o=t}finally{try{if(!c&&null!=r.return&&(u=r.return(),Object(u)!==u))return}finally{if(l)throw o}}return a}}(t,e)||function(t,e){if(t){if("string"==typeof t)return c(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?c(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function c(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function l(t){var n=t.width,o=t.height,u=function(t){for(var n=t.vertsCount,o=t.width,i=t.height,u=[o/2,i/2],a=2*Math.PI/n,c=[],l=0;l<n;++l){var f=e({start:l*a,end:(l+1)*a-a/3,stepsCount:10,includeStart:!0}),p=[Math.cos(f),Math.sin(f)],y=r(u,p,1,s({vertVector:p,centerPoint:u,width:o,height:i,radiusStepsCount:10}));c.push([Math.round(y[0]),Math.round(y[1])])}return c}(t),c=n,l=0,f=o,p=0;u.forEach((function(t){var e=a(t,2),r=e[0],n=e[1];c=r<c?r:c,l=r>l?r:l,f=n<f?n:f,p=n>p?n:p}));var y=u.reduce((function(t,e){return"".concat(t," ").concat(e[0]-c,",").concat(e[1]-f)}),"");return{key:i("polygon"),width:l-c,height:p-f,points:y}}function s(t){var o,i=t.vertVector,u=t.centerPoint,a=t.width,c=t.height,l=t.radiusStepsCount,s=function(t){var e=t.centerPoint,o=t.lineVector,i=t.width,u=t.height;if(n(o[1],0))return null;var a=l(-e[1]/o[1]);if(a)return a;var c=l((u-e[1])/o[1]);if(c)return c;function l(t){if(t<0)return null;var n=r(e,o,1,t);return n[0]<0||n[0]>i?null:n}return null}(o={lineVector:i,centerPoint:u,width:a,height:c})||function(t){var e=t.centerPoint,o=t.lineVector,i=t.height,u=t.width;if(n(o[0],0))return null;var a=l(-e[0]/o[0]);if(a)return a;var c=l((u-e[0])/o[0]);if(c)return c;function l(t){if(t<0)return null;var n=r(e,o,1,t);return n[1]<0||n[1]>i?null:n}return null}(o);if(!s)throw new Error("error while generating a polygon");var f,p,y,h=(y=(f=u,[(p=s)[0]-f[0],p[1]-f[1]]),Math.sqrt(Math.pow(y[0],2)+Math.pow(y[1],2)));return e({start:h/3,end:h,stepsCount:l,includeEnd:!0})}function f(t){return{key:t.getAttribute("polygon-key"),width:Number(t.getAttribute("width")),height:Number(t.getAttribute("height")),points:t.getAttribute("points")}}function p(t){var e=document.createElement("generated-polygon");return e.setAttribute("width",t.width),e.setAttribute("height",t.height),e.setAttribute("polygon-key",t.key),e.setAttribute("points",t.points),e}function y(t){return y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},y(t)}function h(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,v(n.key),n)}}function d(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function b(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?d(Object(r),!0).forEach((function(e){g(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):d(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function g(t,e,r){return(e=v(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function v(t){var e=function(t,e){if("object"!=y(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=y(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==y(e)?e:String(e)}function m(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}var w=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),g(this,"listeners",{bufferPolygonsCreated:[],clearData:[]});var r=b(b({},{scale:1,shift:[0,0],bufferPolygons:[],workPolygons:[]}),t);Object.assign(this,r)}var r,n,o;return r=e,o=[{key:"parsePolygonsForSaving",value:function(t){return t.map((function(t){var e=b({},t);return delete e.key,e}))}},{key:"parsePolygonsFromSaving",value:function(t){return t.map((function(t){return b(b({},t),{},{key:i("polygon")})}))}}],(n=[{key:"saveData",value:function(){var t,r=this,n={};(t=Object.keys({scale:1,shift:[0,0],bufferPolygons:[],workPolygons:[]}),function(t){if(Array.isArray(t))return m(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return m(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?m(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()).forEach((function(t){var o=r[t];switch(t){case"workPolygons":case"bufferPolygons":n[t]=e.parsePolygonsForSaving(o);break;default:n[t]=o}})),localStorage.setItem("storeData",JSON.stringify(n)),alert("Данные сохранены в local storage!")}},{key:"clearData",value:function(){Object.assign(this,{scale:1,shift:[0,0],bufferPolygons:[],workPolygons:[]}),localStorage.clear(),this.callListeners("clearData")}},{key:"createPolygons",value:function(){var r=function(e){for(var r=e.maxHeight,n=t(5,20),o=[],i=0;i<n;++i)o.push(l({width:t(80,150),height:t(80,r),vertsCount:t(3,10)}));return o}({maxHeight:e.maxPolygonHeight});this.bufferPolygons=r,this.callListeners("bufferPolygonsCreated",r)}},{key:"addListener",value:function(t,e){var r=this.listeners[t];r&&r.push(e)}},{key:"removeListener",value:function(t,e){var r=this.listeners[t];r&&(this.listeners[t]=r.filter((function(t){return t!==e})))}},{key:"callListeners",value:function(t,e){var r=this.listeners[t];r&&r.length&&r.forEach((function(t){return t(e)}))}}])&&h(r.prototype,n),o&&h(r,o),Object.defineProperty(r,"prototype",{writable:!1}),e}();g(w,"maxPolygonHeight",110);const P=new w(function(){var t=localStorage.getItem("storeData");if(t)try{var e=Object.assign({scale:1,shift:[0,0],bufferPolygons:[],workPolygons:[]},JSON.parse(t));return b(b({},e),{},{bufferPolygons:w.parsePolygonsFromSaving(e.bufferPolygons),workPolygons:w.parsePolygonsFromSaving(e.workPolygons)})}catch(t){return{}}return{}}());function O(t){return O="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},O(t)}function k(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,j(n.key),n)}}function j(t){var e=function(t,e){if("object"!=O(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=O(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==O(e)?e:String(e)}function S(t){var e="function"==typeof Map?new Map:void 0;return S=function(t){if(null===t||!function(t){try{return-1!==Function.toString.call(t).indexOf("[native code]")}catch(e){return"function"==typeof t}}(t))return t;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,r)}function r(){return function(t,e,r){if(E())return Reflect.construct.apply(null,arguments);var n=[null];n.push.apply(n,e);var o=new(t.bind.apply(t,n));return r&&C(o,r.prototype),o}(t,arguments,T(this).constructor)}return r.prototype=Object.create(t.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),C(r,t)},S(t)}function E(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(E=function(){return!!t})()}function C(t,e){return C=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},C(t,e)}function T(t){return T=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},T(t)}const A=function(t){function e(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),t=this,n=arguments,r=T(r=e),function(t,e){if(e&&("object"===O(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,E()?Reflect.construct(r,n||[],T(t).constructor):r.apply(t,n));var t,r,n}var r,n,o;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&C(t,e)}(e,t),r=e,o=[{key:"doAction",value:function(t){switch(t){case"create":P.createPolygons();break;case"save":P.saveData();break;case"clear":P.clearData()}}}],(n=[{key:"connectedCallback",value:function(){this.attachShadow({mode:"open"}),this.shadowRoot.innerHTML="\n          <style>\n            :host {   \n                display: flex;\n                justify-content: space-evenly;\n                flex-wrap: wrap;\n                align-items: center;\n                gap: 20px;\n            }\n            button {\n                background-color: var(--button-bg-color);\n                padding: 10px 20px;\n                border: none;\n                border-radius: 3px;\n                cursor: pointer;\n                transition: background-color 0.3s;\n            }\n            button:hover {\n                background-color: var(--button-hover-bg-color);\n            }\n            button:active {\n                background-color: var(--button-active-bg-color);\n            }\n            .app-toolbar-right-cnt {\n                display: flex;\n                gap: 20px;\n                align-items: center;\n            }\n          </style>\n          <button data-action='create'>Создать</button>\n          <div class='app-toolbar-right-cnt'>\n            <button data-action='save'>Сохранить</button>\n            <button data-action='clear'>Сбросить</button>\n          </div>\n        ",this.addActionsListeners()}},{key:"addActionsListeners",value:function(){this.shadowRoot.querySelectorAll("button[data-action]").forEach((function(t){t.addEventListener("click",(function(){e.doAction(t.dataset.action)}))}))}}])&&k(r.prototype,n),o&&k(r,o),Object.defineProperty(r,"prototype",{writable:!1}),e}(S(HTMLElement));function D(t){return D="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},D(t)}function x(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,M(n.key),n)}}function M(t){var e=function(t,e){if("object"!=D(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=D(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==D(e)?e:String(e)}function _(t){var e="function"==typeof Map?new Map:void 0;return _=function(t){if(null===t||!function(t){try{return-1!==Function.toString.call(t).indexOf("[native code]")}catch(e){return"function"==typeof t}}(t))return t;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,r)}function r(){return function(t,e,r){if(R())return Reflect.construct.apply(null,arguments);var n=[null];n.push.apply(n,e);var o=new(t.bind.apply(t,n));return r&&L(o,r.prototype),o}(t,arguments,H(this).constructor)}return r.prototype=Object.create(t.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),L(r,t)},_(t)}function R(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(R=function(){return!!t})()}function L(t,e){return L=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},L(t,e)}function H(t){return H=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},H(t)}const B=function(t){function e(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),t=this,n=arguments,r=H(r=e),function(t,e){if(e&&("object"===D(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,R()?Reflect.construct(r,n||[],H(t).constructor):r.apply(t,n));var t,r,n}var r,n;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&L(t,e)}(e,t),r=e,(n=[{key:"connectedCallback",value:function(){this.innerHTML="\n            <app-toolbar></app-toolbar>\n            <dnd-wrapper></dnd-wrapper>\n          "}}])&&x(r.prototype,n),Object.defineProperty(r,"prototype",{writable:!1}),e}(_(HTMLElement));function z(t){return z="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},z(t)}function I(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,q(n.key),n)}}function N(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function F(t){var e="function"==typeof Map?new Map:void 0;return F=function(t){if(null===t||!function(t){try{return-1!==Function.toString.call(t).indexOf("[native code]")}catch(e){return"function"==typeof t}}(t))return t;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,r)}function r(){return function(t,e,r){if(W())return Reflect.construct.apply(null,arguments);var n=[null];n.push.apply(n,e);var o=new(t.bind.apply(t,n));return r&&Y(o,r.prototype),o}(t,arguments,X(this).constructor)}return r.prototype=Object.create(t.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),Y(r,t)},F(t)}function W(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(W=function(){return!!t})()}function Y(t,e){return Y=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Y(t,e)}function X(t){return X=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},X(t)}function U(t,e,r){return(e=q(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function q(t){var e=function(t,e){if("object"!=z(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=z(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==z(e)?e:String(e)}var K=function(t){function e(){var t,r,n,o;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(r=this,n=e,n=X(n),t=function(t,e){if(e&&("object"===z(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return N(t)}(r,W()?Reflect.construct(n,o||[],X(r).constructor):n.apply(r,o))).renderHandler=t.render.bind(N(t)),t}var r,n;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Y(t,e)}(e,t),r=e,(n=[{key:"connectedCallback",value:function(){window.addEventListener("resize",this.renderHandler),P.addListener("bufferPolygonsCreated",this.renderHandler),P.addListener("clearData",this.renderHandler),this.render()}},{key:"disconnectedCallback",value:function(){window.removeEventListener("resize",this.renderHandler),P.removeListener("bufferPolygonsCreated",this.renderHandler),P.removeListener("clearData",this.renderHandler)}},{key:"render",value:function(){var t=P.bufferPolygons;this.innerHTML="",this.layoutPolygons(t)}},{key:"appendPolygon",value:function(t){var e=f(t);P.bufferPolygons.push(e);var r=t.getBoundingClientRect(),n=this.getBoundingClientRect();t.style.left="".concat(r.left-n.left,"px"),t.style.top="".concat(r.top-n.top,"px"),this.append(t)}},{key:"removePolygon",value:function(t){var e=f(t);P.bufferPolygons=P.bufferPolygons.filter((function(t){return t.key!==e.key})),t.remove()}},{key:"layoutPolygons",value:function(t){var r=this,n=this.getBoundingClientRect().width,o=t.length,i=e.polygonPadding,u=0,a=i,c=0;t.forEach((function(e,l){var s=a+e.width+i,f=l===o-1;s<n&&!f?a=s:s<n&&f?r.placePolygonsInRow({rowNumber:u,polygonsData:t.slice(c,o),fullWidth:s}):(r.placePolygonsInRow({rowNumber:u,polygonsData:t.slice(c,l),fullWidth:a}),u+=1,a=2*i+e.width,c=l,f&&r.placePolygonsInRow({rowNumber:u,polygonsData:[t.at(-1)],fullWidth:2*i+t.at(-1).width}))})),this.style.height="".concat(120*(u+1),"px")}},{key:"placePolygonsInRow",value:function(t){var r=this,n=t.rowNumber,o=t.polygonsData,i=t.fullWidth,u=(this.getBoundingClientRect().width-i)/2,a=e.polygonPadding,c=u+a;o.forEach((function(t){var o=p(t);o.style.position="absolute",o.style.left="".concat(c,"px"),o.style.top="".concat(n*w.maxPolygonHeight+e.rowTopPadding,"px"),r.append(o),c+=t.width+a}))}}])&&I(r.prototype,n),Object.defineProperty(r,"prototype",{writable:!1}),e}(F(HTMLElement));U(K,"polygonPadding",5),U(K,"rowTopPadding",5);const V=K;function J(t){return J="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},J(t)}function $(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,nt(n.key),n)}}function G(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Q(t){var e="function"==typeof Map?new Map:void 0;return Q=function(t){if(null===t||!function(t){try{return-1!==Function.toString.call(t).indexOf("[native code]")}catch(e){return"function"==typeof t}}(t))return t;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,r)}function r(){return function(t,e,r){if(Z())return Reflect.construct.apply(null,arguments);var n=[null];n.push.apply(n,e);var o=new(t.bind.apply(t,n));return r&&tt(o,r.prototype),o}(t,arguments,et(this).constructor)}return r.prototype=Object.create(t.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),tt(r,t)},Q(t)}function Z(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(Z=function(){return!!t})()}function tt(t,e){return tt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},tt(t,e)}function et(t){return et=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},et(t)}function rt(t,e,r){return(e=nt(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function nt(t){var e=function(t,e){if("object"!=J(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=J(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==J(e)?e:String(e)}var ot=function(t){function e(){var t,r,n,o;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),rt(G((r=this,n=et(n=e),t=function(t,e){if(e&&("object"===J(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return G(t)}(r,Z()?Reflect.construct(n,o||[],et(r).constructor):n.apply(r,o)))),"startDragMouse",null),t.renderHandler=t.render.bind(G(t)),t.wheelHandler=t.wheel.bind(G(t)),t.resizeHandler=u(t.resize.bind(G(t)),50),t.mouseDownHandler=t.startDragging.bind(G(t)),t.mouseMoveHandler=u(t.doDragging.bind(G(t)),40),t.mouseUpHandler=t.stopDragging.bind(G(t)),t}var r,n,o;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&tt(t,e)}(e,t),r=e,o=[{key:"getCellSize",value:function(){return e.originCellSize*P.scale}},{key:"calculateNewShiftByDelta",value:function(t,r){var n=e.getCellSize(),o=P.shift;return[o[0]+t/n,o[1]+r/n]}}],(n=[{key:"disconnectedCallback",value:function(){this.removeEventListener("wheel",this.wheelHandler),this.removeEventListener("mousedown",this.mouseDownHandler),window.removeEventListener("resize",this.resizeHandler),P.removeEventListener("clearData",this.renderHandler)}},{key:"connectedCallback",value:function(){this.addEventListener("wheel",this.wheelHandler),this.addEventListener("mousedown",this.mouseDownHandler),window.addEventListener("resize",this.resizeHandler),P.addListener("clearData",this.renderHandler),this.render()}},{key:"render",value:function(){var t=P.shift,r=e.step,n=e.getCellSize();this.innerHTML='\n                <work-ruler cell-size="'.concat(n,'" step="').concat(r,'" align="horizontal" shift=').concat(t[0],'></work-ruler>\n                <work-ruler cell-size="').concat(n,'" step="').concat(r,'" align="vertical" shift=').concat(t[1],'></work-ruler>\n                <work-drag-area cell-size="').concat(n,'" origin-cell-size=').concat(e.originCellSize," \n                                shift-x=").concat(t[0]," shift-y=").concat(t[1],"></work-drag-area>\n              ")}},{key:"wheel",value:function(t){if(t.ctrlKey){t.preventDefault();var r=t.deltaY<0?1:-1,n=e.getCellSize(),o=Math.min(Math.max(n+5*r,e.minCellSize),e.maxCellSize);P.scale=o/e.originCellSize,this.render()}}},{key:"resize",value:function(){this.render()}},{key:"startDragging",value:function(t){var e;t.ctrlKey&&0===t.button&&"WORK-AREA"===(null===(e=t.currentTarget)||void 0===e?void 0:e.tagName)&&(this.startDragMouse=[t.clientX,t.clientY],document.addEventListener("mousemove",this.mouseMoveHandler),document.addEventListener("mouseup",this.mouseUpHandler),document.body.style.cursor="grab")}},{key:"stopDragging",value:function(t){var r=t.clientX-this.startDragMouse[0],n=t.clientY-this.startDragMouse[1];P.shift=e.calculateNewShiftByDelta(r,n),this.startDragMouse=null,document.removeEventListener("mousemove",this.mouseMoveHandler),document.removeEventListener("mouseup",this.mouseUpHandler),document.body.style.cursor="auto"}},{key:"getDragArea",value:function(){return this.querySelector("work-drag-area")}},{key:"getRulerY",value:function(){return this.querySelector('work-ruler[align="vertical"]')}},{key:"getRulerX",value:function(){return this.querySelector('work-ruler[align="horizontal"]')}},{key:"doDragging",value:function(t){if(this.startDragMouse){var r=t.clientX-this.startDragMouse[0],n=t.clientY-this.startDragMouse[1],o=e.calculateNewShiftByDelta(r,n),i=this.getDragArea();i.setAttribute("shift-x",o[0]),i.setAttribute("shift-y",o[1]),this.getRulerX().setAttribute("shift",o[0]),this.getRulerY().setAttribute("shift",o[1])}}}])&&$(r.prototype,n),o&&$(r,o),Object.defineProperty(r,"prototype",{writable:!1}),e}(Q(HTMLElement));rt(ot,"minCellSize",20),rt(ot,"originCellSize",30),rt(ot,"maxCellSize",70),rt(ot,"step",10);const it=ot;function ut(t){return ut="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ut(t)}function at(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,ct(n.key),n)}}function ct(t){var e=function(t,e){if("object"!=ut(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=ut(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==ut(e)?e:String(e)}function lt(t){var e="function"==typeof Map?new Map:void 0;return lt=function(t){if(null===t||!function(t){try{return-1!==Function.toString.call(t).indexOf("[native code]")}catch(e){return"function"==typeof t}}(t))return t;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,r)}function r(){return function(t,e,r){if(st())return Reflect.construct.apply(null,arguments);var n=[null];n.push.apply(n,e);var o=new(t.bind.apply(t,n));return r&&ft(o,r.prototype),o}(t,arguments,pt(this).constructor)}return r.prototype=Object.create(t.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),ft(r,t)},lt(t)}function st(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(st=function(){return!!t})()}function ft(t,e){return ft=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},ft(t,e)}function pt(t){return pt=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},pt(t)}const yt=function(t){function e(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),t=this,n=arguments,r=pt(r=e),function(t,e){if(e&&("object"===ut(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,st()?Reflect.construct(r,n||[],pt(t).constructor):r.apply(t,n));var t,r,n}var r,n,o;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&ft(t,e)}(e,t),r=e,o=[{key:"observedAttributes",get:function(){return["cell-size","step","vertical","shift"]}}],(n=[{key:"connectedCallback",value:function(){this.render()}},{key:"render",value:function(){var t=parseInt(this.getAttribute("cell-size")),e=parseInt(this.getAttribute("step"));if(!Number.isNaN(t)&&!Number.isNaN(e)){this.innerHTML="";var r=this.getBoundingClientRect(),n="vertical"===this.getAttribute("align"),o=n?r.height:r.width,i=Math.ceil(o/t);this.renderMarks({vertical:n,marksCount:i,step:e,cellSize:t})}}},{key:"renderMarks",value:function(t){for(var e=t.marksCount,r=t.step,n=t.cellSize,o=t.vertical,i=this.getShift(),u=i%1,a=Math.trunc(i),c=o?1:-1,l=0;l<=e;++l){var s=l*n-c*u*n;if(!(s<0)){var f=r*(l+c*a),p=document.createElement("div");p.style.position="absolute",o?(p.style.right="3px",p.style.bottom="".concat(s,"px")):(p.style.top="3px",p.style.left="".concat(s,"px")),p.innerText="".concat(f),this.append(p)}}}},{key:"getShift",value:function(){return Number(this.getAttribute("shift"))||0}},{key:"attributeChangedCallback",value:function(){this.render()}}])&&at(r.prototype,n),o&&at(r,o),Object.defineProperty(r,"prototype",{writable:!1}),e}(lt(HTMLElement));function ht(t){return ht="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ht(t)}function dt(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function bt(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?dt(Object(r),!0).forEach((function(e){kt(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):dt(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function gt(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,jt(n.key),n)}}function vt(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function mt(t){var e="function"==typeof Map?new Map:void 0;return mt=function(t){if(null===t||!function(t){try{return-1!==Function.toString.call(t).indexOf("[native code]")}catch(e){return"function"==typeof t}}(t))return t;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,r)}function r(){return function(t,e,r){if(wt())return Reflect.construct.apply(null,arguments);var n=[null];n.push.apply(n,e);var o=new(t.bind.apply(t,n));return r&&Pt(o,r.prototype),o}(t,arguments,Ot(this).constructor)}return r.prototype=Object.create(t.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),Pt(r,t)},mt(t)}function wt(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(wt=function(){return!!t})()}function Pt(t,e){return Pt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Pt(t,e)}function Ot(t){return Ot=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Ot(t)}function kt(t,e,r){return(e=jt(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function jt(t){var e=function(t,e){if("object"!=ht(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=ht(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==ht(e)?e:String(e)}const St=function(t){function e(){var t,r,n,o;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);for(var i=arguments.length,u=new Array(i),a=0;a<i;a++)u[a]=arguments[a];return kt(vt((r=this,n=e,o=[].concat(u),n=Ot(n),t=function(t,e){if(e&&("object"===ht(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return vt(t)}(r,wt()?Reflect.construct(n,o||[],Ot(r).constructor):n.apply(r,o)))),"canvasEl",null),kt(vt(t),"polygonsEl",null),t}var r,n,o;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Pt(t,e)}(e,t),r=e,o=[{key:"observedAttributes",get:function(){return["cell-size","origin-cell-size","shift-x","shift-y"]}}],(n=[{key:"connectedCallback",value:function(){if(!this.canvasEl){var t=document.createElement("canvas"),e=this.getBoundingClientRect();t.setAttribute("width",e.width),t.setAttribute("height",e.height),t.style.position="absolute",t.style.bottom="0px",t.style.left="0px",this.canvasEl=t,this.append(t)}if(!this.polygonsEl){var r=document.createElement("div");this.append(r),this.polygonsEl=r}this.render()}},{key:"attributeChangedCallback",value:function(){this.render()}},{key:"render",value:function(){var t=this.canvasEl;if(t){var e=t.getContext("2d");e.clearRect(0,0,t.width,t.height);var r=parseInt(this.getAttribute("cell-size"));null===e||Number.isNaN(r)||(this.drawCells({ctx:e,cellSize:r,width:t.width,height:t.height}),this.renderPolygons())}}},{key:"renderPolygons",value:function(){var t=this,e=this.polygonsEl,r=P.workPolygons,n=[];r.filter((function(e){return t.checkPolygonInView(e)})).forEach((function(e){var r=p(e);r.style.position="absolute";var o=t.getPositionByWorkCoordinates(e);r.style.left="".concat(o.left,"px"),r.style.top="".concat(o.top,"px"),r.style.transform="scale(".concat(t.getScale(),")"),n.push(r)})),e.replaceChildren.apply(e,n)}},{key:"checkPolygonInView",value:function(t){var e=t.workLeft,r=t.workTop,n=this.getBoundingClientRect(),o=this.getWorkCoordinatesByPosition({left:0,top:n.height}),i=o.workLeft,u=o.workTop,a=this.getWorkCoordinatesByPosition({left:n.width,top:0}),c=a.workLeft,l=a.workTop,s=this.getAttribute("origin-cell-size"),f=e+t.width/s,p=r-t.height/s;return(e<=c&&e>=i||f<=c&&f>=i)&&(r<=l&&r>=u||p<=l&&p>=u)}},{key:"getScale",value:function(){return this.getAttribute("cell-size")/this.getAttribute("origin-cell-size")}},{key:"appendPolygon",value:function(t){var e=f(t),r=t.getBoundingClientRect(),n=this.getBoundingClientRect(),o=r.left-n.left,i=r.top-n.top;t.style.left="".concat(o,"px"),t.style.top="".concat(i,"px");var u=this.getWorkCoordinatesByPosition({left:o,top:i});P.workPolygons.push(bt(bt({},e),u)),this.polygonsEl.append(t)}},{key:"removePolygon",value:function(t){var e=f(t);P.workPolygons=P.workPolygons.filter((function(t){return t.key!==e.key})),t.remove()}},{key:"getWorkCoordinatesByPosition",value:function(t){var e=t.left,r=t.top,n=this.getBoundingClientRect(),o=this.getAttribute("cell-size"),i=this.getAttribute("shift-x"),u=this.getAttribute("shift-y");return{workLeft:this.fromPixelsToCoordinate(e-i*o),workTop:this.fromPixelsToCoordinate(n.height-r+u*o)}}},{key:"getPositionByWorkCoordinates",value:function(t){var e=t.workLeft,r=t.workTop,n=this.getBoundingClientRect(),o=this.getAttribute("shift-x"),i=this.getAttribute("shift-y"),u=this.getAttribute("cell-size");return{left:this.fromCoordinateToPixels(e)+o*u,top:n.height+i*u-this.fromCoordinateToPixels(r)}}},{key:"fromPixelsToCoordinate",value:function(t){return t/Number(this.getAttribute("cell-size"))}},{key:"fromCoordinateToPixels",value:function(t){return t*Number(this.getAttribute("cell-size"))}},{key:"drawCells",value:function(t){var e=t.ctx,r=t.cellSize,n=t.width,o=t.height;e.strokeStyle="lightgrey";for(var i=this.getAttribute("shift-x")%1*r,u=this.getAttribute("shift-y")%1*r,a=Math.ceil(o/r),c=0;c<=a;++c){e.beginPath();var l=u+o-c*r;e.moveTo(0,l),e.lineTo(n,l),e.stroke()}for(var s=Math.floor(n/r),f=0;f<=s;++f){e.beginPath();var p=i+f*r;e.moveTo(p,0),e.lineTo(p,o),e.stroke()}}}])&&gt(r.prototype,n),o&&gt(r,o),Object.defineProperty(r,"prototype",{writable:!1}),e}(mt(HTMLElement));function Et(t){return Et="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Et(t)}function Ct(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Rt(n.key),n)}}function Tt(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function At(t){var e="function"==typeof Map?new Map:void 0;return At=function(t){if(null===t||!function(t){try{return-1!==Function.toString.call(t).indexOf("[native code]")}catch(e){return"function"==typeof t}}(t))return t;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,r)}function r(){return function(t,e,r){if(Dt())return Reflect.construct.apply(null,arguments);var n=[null];n.push.apply(n,e);var o=new(t.bind.apply(t,n));return r&&xt(o,r.prototype),o}(t,arguments,Mt(this).constructor)}return r.prototype=Object.create(t.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),xt(r,t)},At(t)}function Dt(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(Dt=function(){return!!t})()}function xt(t,e){return xt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},xt(t,e)}function Mt(t){return Mt=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Mt(t)}function _t(t,e,r){return(e=Rt(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function Rt(t){var e=function(t,e){if("object"!=Et(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=Et(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Et(e)?e:String(e)}const Lt=function(t){function e(){var t,r,n,o;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),_t(Tt((r=this,n=Mt(n=e),t=function(t,e){if(e&&("object"===Et(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return Tt(t)}(r,Dt()?Reflect.construct(n,o||[],Mt(r).constructor):n.apply(r,o)))),"draggedPolygon",null),_t(Tt(t),"draggedInitialPosition",null),_t(Tt(t),"dragFromTarget",null),_t(Tt(t),"bufferArea",null),_t(Tt(t),"workArea",null),t.mouseDownHandler=t.startDragPolygon.bind(Tt(t)),t.mouseMoveHandler=u(t.doDragPolygon.bind(Tt(t)),30),t.mouseUpHandler=t.stopDragPolygon.bind(Tt(t)),t}var r,n,i;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&xt(t,e)}(e,t),r=e,i=[{key:"stopWheel",value:function(t){t.ctrlKey&&(t.preventDefault(),t.stopImmediatePropagation())}}],(n=[{key:"connectedCallback",value:function(){this.bufferArea=document.createElement("buffer-area"),this.workArea=document.createElement("work-area"),this.append(this.bufferArea),this.append(this.workArea),this.bufferArea.addEventListener("mousedown",this.mouseDownHandler),this.workArea.addEventListener("mousedown",this.mouseDownHandler)}},{key:"disconnectedCallback",value:function(){this.bufferArea.removeEventListener("mousedown",this.mouseDownHandler),this.workArea.removeEventListener("mousedown",this.mouseDownHandler)}},{key:"getBufferArea",value:function(){return this.bufferArea}},{key:"getWorkArea",value:function(){return this.workArea}},{key:"getWorkDragArea",value:function(){return this.getWorkArea().querySelector("work-drag-area")}},{key:"startDragPolygon",value:function(t){if(!this.draggedPolygon&&!t.ctrlKey&&0===t.button&&"generated-polygon"===t.target.tagName.toLowerCase()){var e=t.target,r=e.getBoundingClientRect();this.draggedInitialPosition={left:r.left+window.scrollX,top:r.top+window.scrollY,width:r.width,height:r.height};var n=e.cloneNode(!0),i=this.getDragTargetByChild(e);i.removePolygon(e);var u=1;i===this.getBufferArea()&&(u=P.scale,n.style.transform="scale(".concat(u,")")),o({clientX:t.clientX,clientY:t.clientY,draggedObject:n,width:this.draggedInitialPosition.width*u,height:this.draggedInitialPosition.height*u}),document.body.append(n),this.draggedPolygon=n,this.dragFromTarget=i,this.initDragMode()}}},{key:"doDragPolygon",value:function(t){var e=this.draggedPolygon,r=this.draggedInitialPosition;if(e&&r){var n=e.getBoundingClientRect();o({clientX:t.clientX,clientY:t.clientY,draggedObject:e,width:n.width,height:n.height})}}},{key:"stopDragPolygon",value:function(t){var e=this.draggedPolygon;if(e){e.style.display="none";var r=document.elementFromPoint(t.clientX,t.clientY),n=this.getDragTargetByChild(r);n||(n=this.dragFromTarget,e.style.left="".concat(this.draggedInitialPosition.left,"px"),e.style.top="".concat(this.draggedInitialPosition.top,"px")),e.style.display="block",n===this.getBufferArea()&&(e.style.transform="scale(1)"),n.appendPolygon(e),this.clearDragMode()}}},{key:"initDragMode",value:function(){document.addEventListener("mousemove",this.mouseMoveHandler),document.addEventListener("mouseup",this.mouseUpHandler),document.addEventListener("wheel",e.stopWheel,{passive:!1})}},{key:"clearDragMode",value:function(){this.dragFromTarget=null,this.draggedPolygon=null,this.draggedInitialPosition=null,document.removeEventListener("mousemove",this.mouseMoveHandler),document.removeEventListener("mouseup",this.mouseUpHandler),document.removeEventListener("wheel",e.stopWheel,{passive:!1})}},{key:"getDragTargetByChild",value:function(t){return t?t===this.getBufferArea()||t===this.getWorkDragArea()?t:this.getDragTargetByChild(t.parentElement):null}}])&&Ct(r.prototype,n),i&&Ct(r,i),Object.defineProperty(r,"prototype",{writable:!1}),e}(At(HTMLElement));function Ht(t){return Ht="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ht(t)}function Bt(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,zt(n.key),n)}}function zt(t){var e=function(t,e){if("object"!=Ht(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=Ht(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Ht(e)?e:String(e)}function It(t){var e="function"==typeof Map?new Map:void 0;return It=function(t){if(null===t||!function(t){try{return-1!==Function.toString.call(t).indexOf("[native code]")}catch(e){return"function"==typeof t}}(t))return t;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,r)}function r(){return function(t,e,r){if(Nt())return Reflect.construct.apply(null,arguments);var n=[null];n.push.apply(n,e);var o=new(t.bind.apply(t,n));return r&&Ft(o,r.prototype),o}(t,arguments,Wt(this).constructor)}return r.prototype=Object.create(t.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),Ft(r,t)},It(t)}function Nt(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(Nt=function(){return!!t})()}function Ft(t,e){return Ft=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Ft(t,e)}function Wt(t){return Wt=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Wt(t)}const Yt=function(t){function e(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),t=this,n=arguments,r=Wt(r=e),function(t,e){if(e&&("object"===Ht(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,Nt()?Reflect.construct(r,n||[],Wt(t).constructor):r.apply(t,n));var t,r,n}var r,n,o;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Ft(t,e)}(e,t),r=e,o=[{key:"observedAttributes",get:function(){return["width","height","points","polygonKey"]}}],(n=[{key:"connectedCallback",value:function(){this.shadowRoot||this.attachShadow({mode:"open"}),this.render()}},{key:"render",value:function(){if(this.shadowRoot){var t=this.getAttribute("width"),e=this.getAttribute("height"),r=this.getAttribute("points"),n=this.getAttribute("polygon-key");this.shadowRoot.innerHTML="\n            <style>\n                :host {\n                    fill: var(--polygon-bg-color);\n                    fill-opacity: 0.7;\n                    stroke: var(--polygon-bg-color);\n                    cursor: pointer;\n                    transform-origin: top left;\n                }\n            </style>\n            <svg width=".concat(t," height=").concat(e," data-polygonKey=").concat(n,">\n                <polygon></polygon>\n            </svg>\n            "),this.shadowRoot.querySelector("polygon").setAttribute("points",r)}}},{key:"attributeChangedCallback",value:function(){this.render()}}])&&Bt(r.prototype,n),o&&Bt(r,o),Object.defineProperty(r,"prototype",{writable:!1}),e}(It(HTMLElement));customElements.define("app-toolbar",A),customElements.define("main-grid",B),customElements.define("dnd-wrapper",Lt),customElements.define("buffer-area",V),customElements.define("generated-polygon",Yt),customElements.define("work-area",it),customElements.define("work-ruler",yt),customElements.define("work-drag-area",St)})();